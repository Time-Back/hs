<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
</head>
<body onload='query()'>
	<p>
		用户编号
		<span id='uid'></span>
	</p>
	<p>
		修改用户名
		<input type="text" id='uname'><span id='d1'></span>
	</p>
	<p>
		修改密码
		<input type="password" id='upwd'>
	</p>
	<p>
		确认密码
		<input type="password" id='cpwd'>
	</p>
	<p>
		修改邮箱
		<input type="email" id='email'>
	</p>
	<p>
		修改电话
		<input type="tel" id='phone'>
	</p>
	<p>
		修改性别
		<input type="radio" name='gender' id='m' value='1'>
		<label for="m">男</label>
		<input type="radio" name='gender' id='f' value='0'>
		<label for="f">女</label>
		<input type="radio" name='gender' id='un' value='-1'>
		<label for="un">保密</label>
	</p>
	<button onclick='user_update()'>修改</button>
	<script>
		function query(){
			//从url中获取当前的uid
			var urlParams=new URLSearchParams(location.search);
			var in_uid = urlParams.get('uid');
			var xhr = new XMLHttpRequest();
			xhr.onreadystatechange = function(){
				if(xhr.readyState==4 && xhr.status==200){
					var result = xhr.responseText;
					var user = JSON.parse(result);
					uid.innerHTML=user.uid;
					uname.value=user.uname;
					upwd.value=user.upwd;
					email.value=user.email;
					phone.value=user.phone;
					if(user.gender==1){
						m.checked=true;
					}else if(user.gender==0){
						f.checked=true;
					}else{
						un.checked=true;
					}
				}
			}
			xhr.open('get','http://127.0.0.1:8080/user/query?uid='+in_uid,true);
			xhr.send();
		}
		function user_update(){
			var u_id=uid.innerHTML;
			var u_name=uname.value;
			var u_pwd=upwd.value;
			var c_pwd=cpwd.value;
			var e_mail=email.value;
			var p_hone=phone.value;
			var g_ender='1';
			if(m.checked){
				g_ender='1';
			}else if(f.checked){
				g_ender='0';
			}else{
				g_ender='-1';
			}
			if(u_pwd==c_pwd){
				var xhr=new XMLHttpRequest();
				xhr.onreadystatechange = function(){
					if(xhr.readyState==4 && xhr.status==200){
						var result = xhr.responseText;
						if(result==1){
							alert('修改成功');
							//js页面跳转
							location.href='http://127.0.0.1:8080/user_list.html';
						}else if(result==2){
							alert('用户名不能为空'); 
						}else if(result==3){
							alert('用户密码不能为空');
						}else if(result==4){
							alert('用户邮箱不能为空');
						}else if(result==5){
							alert('用户电话不能为空');
						}else{
							alert('用户性别未接收到');
						}
					}
				}
				xhr.open('post','http://127.0.0.1:8080/user/update',true);
				xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');
				var formdata = 'uid='+u_id+'&uname='+u_name+'&upwd='+u_pwd+'&email='+e_mail+'&phone='+p_hone+'&gender='+g_ender;
				xhr.send(formdata);
			}else{
				alert('俩次密码输入不一致');
			}
		}	
	</script>
</body>
</html>